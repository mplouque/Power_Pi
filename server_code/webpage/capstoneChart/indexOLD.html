<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript" src="jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="canvasjs.min.js"></script>
<script type="text/javascript">

window.onload = function () 
{

	var dps = []; // dataPoints
	var chart = new CanvasJS.Chart("chartContainer", 
		{
		theme: "dark1",
		
		title :
			{
				text: "POWER PI"
			},
		axisX:
		{
	        title: "Time",
	        labelFormatter: function (e) {
				return CanvasJS.formatDate( e.value, "hh:mm:ss T");
			},
	        gridThickness: 2
    	},

		axisY: 
		{
			title: "Value",
			includeZero: false
		},      
		data: 
		[{
			type: "line",
			dataPoints: dps
		}]
});

var id = "<?php echo $_GET['id'] ?>"
var updateInterval = 2000;
var currListRows = [];

var updateChart = function () 
{ 
	$.ajax({
		url:"getData.php",
		dataType: "json",
		// If connection is successfully made this will manually convert json data into data for Google Charts API to use
		success: function (jsonData)
		{
			console.log("jsonData");
			console.log(jsonData);

			currListRows.length = 0;

		    for(var i = jsonData.length-1; i >= 0; i--) {
		        currListRows.push(jsonData[i]);
		    }
			
			// key is current index of loop
			// json array2 is list of rows up to 20, use title of column
			// make dps 0 to clear the list
			console.log("currListRows of up to 20");
			console.log(currListRows);
			dps.length = 0;
			$.each(currListRows, function(key, jsonArray2)
			{
				var oldDate = (jsonArray2.timestamp).split(/[- :]/);
				// -1 because javascript has months 0-11, +3 because it tiries to convert to central time
				var newDate = new Date(Date.UTC((oldDate[0]), (oldDate[1])-1, (oldDate[2]), (oldDate[3]), (oldDate[4]), (oldDate[5])));

				dps.push({x: newDate, y: Number(jsonArray2.watts), markerColor: "red", markerType: "circle"});
			});	

			chart.render();
			//chart.data[0].dataPoints.remove();

		}
	});

};


updateChart();
setInterval(function(){updateChart()}, updateInterval);

}
</script>
</head>
<body>
<div id="chartContainer" style="height: 370px; width:100%;"></div>